<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tech Trend Blog</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <style>
      body {
        background: #f8f9fa;
      }
      .blog-card {
        background: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      }
      .markdown-body h1,
      .markdown-body h2,
      .markdown-body h3 {
        margin-top: 1.5rem;
      }
      .markdown-body pre {
        background: #0f172a;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 0.75rem;
      }
      .markdown-body code {
        background: #e2e8f0;
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
      }
    </style>
  </head>
  <body class="py-4">
    <div class="container">
      <header class="mb-4 text-center">
        <h1 class="display-6 fw-bold">Tech Trend Blog</h1>
        <p class="text-muted">
          xAI から取得した情報をまとめています。内容に誤りがある可能性があります。
        </p>
      </header>

      <section class="blog-card p-4 mb-4">
        <div class="row g-3 align-items-end">
          <div class="col-md-6">
            <label class="form-label fw-semibold">日付を選択</label>
            <input class="form-control" type="date" name="date" />
          </div>
          <div class="col-md-6 text-md-end">
            <button
              class="btn btn-primary"
              id="load-entry"
              type="button"
            >
              記事を表示
            </button>
          </div>
        </div>
        <p class="small text-muted mt-3 mb-0" id="date-range"></p>
      </section>

      <section class="blog-card p-4" id="entry-content">
        <p class="text-muted">読み込み中...</p>
      </section>

      <footer class="text-center mt-4 text-muted small">
        <div>Tech Trend Blog · Cloudflare Pages</div>
        <div>
          プロジェクト:
          <a
            href="https://github.com/mihashi-toshitaka/tech-trend-archiver"
            target="_blank"
            rel="noopener"
          >
            tech-trend-archiver
          </a>
          /
          <a
            href="https://github.com/mihashi-toshitaka/tech-trend-blog"
            target="_blank"
            rel="noopener"
          >
            tech-trend-blog
          </a>
        </div>
      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
      const applyMeta = (meta) => {
        const dateInput = document.querySelector("input[name='date']");
        const rangeText = document.getElementById("date-range");
        if (!dateInput || !rangeText) return;
        dateInput.min = meta.minDate;
        dateInput.max = meta.maxDate;
        dateInput.value = meta.defaultDate;
        rangeText.textContent = `${meta.minDate} から ${meta.maxDate} まで遡れます。`;
      };

      const loadEntries = () => {
        const dateInput = document.querySelector("input[name='date']");
        if (!dateInput) return;
        htmx.ajax("GET", "/api/entry", {
          target: "#entry-content",
          swap: "innerHTML",
          values: { date: dateInput.value },
        });
      };

      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const response = await fetch("/api/meta");
          if (!response.ok) {
            throw new Error("meta fetch failed");
          }
          const meta = await response.json();
          applyMeta(meta);
        } catch (error) {
          const rangeText = document.getElementById("date-range");
          if (rangeText) {
            rangeText.textContent = "日付情報の読み込みに失敗しました。";
          }
        }
        loadEntries();
      });

      document.getElementById("load-entry")?.addEventListener("click", () => {
        loadEntries();
      });
    </script>
  </body>
</html>
